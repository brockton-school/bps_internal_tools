{% extends "base.html" %}
{% block title %}Admin Settings Â· Internal Tools{% endblock %}
{% block content %}
  <div class="card">
    <h2 style="margin-top:0">Users</h2>

    {% with msgs = get_flashed_messages(with_categories=true) %}
      {% if msgs %}
        {% for cat,msg in msgs %}
          <div class="notice {% if cat=='error' %}error{% endif %}">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Create user -->
    <form method="post" action="{{ url_for('admin.create_user') }}" style="margin-bottom:16px;">
      <label>Username</label>
      <input class="input" name="username" required>
      <label>Display Name</label>
      <input class="input" name="display_name" placeholder="Optional">
      <label>Roles (comma-separated)</label>
      <input class="input" name="roles" placeholder="e.g. admin,attendance">
      <label>Password</label>
      <input class="input" type="password" name="password" required>
      <button class="btn" type="submit">Create User</button>
    </form>

    <div class="grid">
      {% for u in users %}
      <div class="tile" style="flex-direction:column; align-items:stretch;">
        <form method="post" action="{{ url_for('admin.update_user_route', username=u.username) }}">
          <div><strong>{{ u.username }}</strong> {% if not u.active %}<span style="color:#ffa6a6;">(inactive)</span>{% endif %}</div>
          <label style="margin-top:8px;">Display Name</label>
          <input class="input" name="display_name" value="{{ u.display_name }}">
          <label>Roles (comma-separated)</label>
          <input class="input" name="roles" value="{{ (u.roles or [])|join(',') }}">
          <label style="display:flex;align-items:center;gap:8px;margin-top:8px;">
            <input type="checkbox" name="active" {% if u.active %}checked{% endif %}>
            Active
          </label>
          <label>New Password (optional)</label>
          <input class="input" type="password" name="new_password" placeholder="Leave blank to keep existing">
          <div style="display:flex;gap:8px;margin-top:10px;">
            <button class="btn" type="submit" style="width:auto;">Save</button>
            <form method="post" action="{{ url_for('admin.delete_user_route', username=u.username) }}" onsubmit="return confirm('Delete user {{u.username}}?')">
              <button class="btn danger" type="submit" style="width:auto;">Delete</button>
            </form>
          </div>
        </form>
      </div>
      {% endfor %}
    </div>
  </div>
{% endblock %}

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Brockton TOC Attendance{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  {% block head %}{% endblock %}
</head>
<body>
  <div class="container">
    <!-- Top App Bar -->
    <header class="topbar">
      <div class="topbar-left">
        <a class="brand" href="{{ url_for('tools_index') }}" aria-label="Brockton Tools Home">
          <img src="{{ url_for('static', filename='bps-crest_WHITE.png') }}" alt="Brockton Public Schools crest" class="logo-dark">
          <img src="{{ url_for('static', filename='bps-crest.png') }}" alt="Brockton Public Schools crest" class="logo-light">
        </a>
        <div class="titles">
          <h1 class="app-title">
            {% if active_tool %}{{ active_tool }}{% else %}Brockton School Internal Tools{% endif %}
          </h1>
          <div class="app-sub">
            {% if active_tool %}
              {{ page_subtitle or "Fast, simple, and touch-friendly" }}
            {% else %}
              {{ page_subtitle or "Choose a tool to begin" }}
            {% endif %}
          </div>
        </div>
      </div>

      {% if auth_user %}
      <div class="topbar-right">
        <div class="user-menu">
          <button class="avatar-btn" id="userMenuBtn" aria-haspopup="true" aria-expanded="false" title="{{ auth_user.display_name or auth_user.username }}">
            <span class="avatar-initials">
              {{ (auth_user.display_name or auth_user.username) | initials }}
            </span>
          </button>
          <div class="menu" id="userDropdown" role="menu" aria-labelledby="userMenuBtn">
            <div class="menu-header">{{ auth_user.display_name or auth_user.username }}</div>
            <a class="menu-item" href="{{ url_for('tools_index') }}">All Tools</a>
            <!-- Future: <a class="menu-item" href="#">Profile</a> -->

            {% if 'admin' in (auth_user.role or []) %}
            <a class="menu-item" href="{{ url_for('admin.settings_home') }}">Settings</a>
            {% endif %}
            
            <!-- Light theme toggle -->
            <button class="menu-item" type="button" id="themeToggleBtn">
              Toggle Light Theme
            </button>
            
            <form method="post" action="{{ url_for('auth.logout') }}">
              <button class="menu-item logout" type="submit">Log out</button>
            </form>
          </div>
        </div>
      </div>
      {% endif %}
    </header>

    {% block content %}{% endblock %}

    <footer>
      <div>{{ copyright_text }}</div>
      <div>
        Version:
        {% if version_url %}
          <a href="{{ version_url }}" target="_blank">{{ version_info }}</a>
        {% else %}
          {{ version_info }}
        {% endif %}
        {% if commit_url %}
          (<a href="{{ commit_url }}" target="_blank">{{ commit_hash }}</a>)
        {% else %}
          ({{ commit_hash }})
        {% endif %}
      </div>
    </footer>
  </div>
  {% block scripts %}{% endblock %}
  <script src="{{ url_for('static', filename='ui.js') }}"></script>
</body>
</html>

{% extends "base.html" %}
{% block title %}Admin Â· Users{% endblock %}
{% block content %}
<div class="card">
  <h2 style="margin-top:0">Create User</h2>
  <form method="post" action="{{ url_for('admin.create_user_route') }}" style="margin-bottom:16px;">
    <label>Username</label>
    <input class="input" name="username" required>
    <label>Display Name</label>
    <input class="input" name="display_name">
    <label>Role</label>
    <select class="input" name="role" required>
      {% for r in roles if r.active %}
      <option value="{{ r.role }}">{{ r.role }}</option>
      {% endfor %}
    </select>
    <label>Password</label>
    <input class="input" type="password" name="password" required>
    <button class="btn" type="submit">Create User</button>
  </form>
</div>

<div class="card" style="margin-top:16px;">
  <h2 style="margin-top:0">Existing Users</h2>
  <div class="grid">
    {% for u in users %}
    <div class="tile col">
      <form method="post" action="{{ url_for('admin.update_user_route', username=u.username) }}" class="user-edit-form">
        <div><strong>{{ u.username }}</strong> {% if not u.active %}<span class="text-warn">(inactive)</span>{% endif %}</div>

        <label class="mt-8">Display Name</label>
        <input class="input" name="display_name" value="{{ u.display_name }}">

        <label class="mt-8">Role</label>
        <select class="input" name="role">
          {% for r in roles if r.active %}
          <option value="{{ r.role }}" {% if r.role == u.role %}selected{% endif %}>{{ r.role }}</option>
          {% endfor %}
        </select>

        <label class="mt-8 inline">
          <input type="checkbox" name="active" {% if u.active %}checked{% endif %}> Active
        </label>

        <label class="mt-8">New Password (optional)</label>
        <input class="input" type="password" name="new_password" placeholder="Leave blank to keep existing">

        <div class="row mt-10">
          <button class="btn" type="submit">Save</button>

          <!-- Delete submits to a different endpoint via formaction -->
          <button
            class="btn danger outline confirm-delete"
            type="submit"
            formmethod="post"
            formaction="{{ url_for('admin.delete_user_route', username=u.username) }}"
            formnovalidate
            aria-label="Delete user {{ u.display_name }}"
          >
            Delete
          </button>
        </div>
      </form>
    </div>
    {% endfor %}

  </div>
</div>
{% endblock %}
